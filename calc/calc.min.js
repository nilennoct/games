!function(e){var t={};t.util={randInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},generateNumbers:function(){return[t.util.randInt(3,9),t.util.randInt(3,14)]},generateDelta:function(){return t.util.randInt(1,3)*(Math.random()<.5?-1:1)},generateOperator:function(){var e=Math.random();return.3>e?"+":.6>e?"-":.8>e?"*":"/"},getEqualFlag:function(){var e,t=0;return function(){var n=Math.random()<.5;return n===e?t>=2&&Math.random()<(t+1)/10?(n=!n,t=1):t++:t=1,e=n}}(),bindTap:function(t,n){if("ontouchend"in e){var i,r;t.addEventListener("touchstart",function(e){i=e.touches[0],r=e.timestamp}),t.addEventListener("touchend",function(e){var a=e.changedTouches[0];e.timestamp-r>=400||Math.max(Math.abs(a.clientX-i.clientX),Math.abs(a.clientY-i.clientY))>10||(n.call(t,e),e.preventDefault())}),t.addEventListener("click",function(e){e.preventDefault()})}else t.addEventListener("click",function(e){n.call(t,e)})},show:function(e,t){t=t||"block",e.style.cssText="display: "+t+";"},hide:function(e){e.style.cssText="display: none;"}},t.status=function(){var n=0,i=-1,r=null;return{check:function(){return 0===n},getEqual:function(){return r},next:function(){1!==n&&(t.ui.process.style.cssText="width: 0%;",t.ui.score.innerText=++i,(25===i||45===i||60===i||75===i||90===i)&&t.timer.speedUp(),r=t.process())},end:function(){n=1,t.timer.clearTimer(),t.ui.result.innerHTML="<p>游戏结束</p><p>最终得分："+i+"</p>";var r=e.localStorage.getItem("highest");i>r&&(t.ui.highest.innerText="历史最高分："+i,e.localStorage.setItem("highest",i)),t.ui.restartBtn.innerText="► 重试",t.ui.handleReviveBtn(),t.share.desc="我得了"+i+"分，你能算得比我快吗？速算小游戏，看谁算得快？",t.util.show(t.ui.mask)},reset:function(){i=-1,t.timer.resetDuration(),t.ui.score.innerText=n=0,t.share.desc="速算小游戏，看谁算得快？",t.util.hide(t.ui.mask),t.status.next()},revive:function(){var r=e.localStorage.getItem("lives")||0;return 0>=r?void t.status.reset():(r-=1,e.localStorage.setItem("lives",r),n=0,i>=0&&(i-=1),t.util.hide(t.ui.mask),void t.status.next())}}}(),t.timer=function(){var e=null,n=3e3,i,r;return{speedUp:function(){n>2e3?n-=1e3:n>1e3?n-=500:n>500?n-=250:n/=2},checkCheat:function(){var e=+new Date-r-i;return e>500?(t.ui.process.style.cssText="width: 100%;",t.status.end(),!1):(r+=e,!0)},clearTimer:function(){clearInterval(e)},resetDuration:function(){n=3e3},resetTimer:function(){clearInterval(e),i=0,t.ui.process.style.cssText="width: 0%;",r=+new Date,e=setInterval(function(){i+=n/10,t.timer.checkCheat()&&(t.ui.process.style.cssText="width: "+i/n*100+"%;",i>=n&&t.status.end())},n/10)}}}(),t.process=function(){var e=t.util.generateNumbers(),n=t.util.getEqualFlag(),i=0;n||(i=t.util.generateDelta());var r=t.util.generateOperator(),a,s="";switch(r){case"+":e[2]=e[0]+e[1]+i,a=e[0]+" ＋ "+e[1];break;case"-":e[2]=e[0],e[0]=e[0]+e[1]+i,a=e[0]+" － "+e[1];break;case"*":e[2]=e[0]*e[1]+i,a=e[0]+" × "+e[1];break;case"/":e[2]=e[0],e[0]=e[0]*e[1],Math.random()<.5?e[1]+=i:e[2]+=i,a=e[0]+" ÷ "+e[1]}return s+=Math.random()<.5?a+" ＝ "+e[2]:e[2]+" ＝ "+a,t.ui.equation.innerText=s,t.timer.resetTimer(),n},t.share={appId:"",img:location.href.substring(0,location.href.lastIndexOf("/"))+"/calc.png",imgSize:"120",url:location.href.substring(0,location.href.lastIndexOf("?"))+"?"+t.util.randInt(1e8,1e9-1),title:"谁算得快？",desc:"速算小游戏，看谁算得快？",getBonus:function(){var n=e.localStorage.getItem("date");if(null===n)n=new Date,n=+new Date(n.getFullYear(),n.getMonth(),n.getDate());else if(Date.now()-n<864e5)return;e.localStorage.setItem("lives",3),e.localStorage.setItem("date",n),t.ui.handleReviveBtn()}};var n=e.document;e.addEventListener("load",function(){if(t.ui={score:n.getElementById("score"),process:n.getElementById("process"),equation:n.getElementById("equation"),mask:n.getElementById("mask"),result:n.getElementById("result"),highest:n.getElementById("highest"),restartBtn:n.getElementById("restartBtn"),reviveBtn:n.getElementById("reviveBtn")},t.ui.handleReviveBtn=function(){var n=e.localStorage.getItem("lives")||0;n>0?(t.ui.reviveBtn.innerText="复活("+n+")",t.util.show(t.ui.reviveBtn,"inline-block")):t.util.hide(t.ui.reviveBtn)},t.util.bindTap(n.getElementById("trueBtn"),function(){t.status.check()&&t.timer.checkCheat()&&(t.status.getEqual()===!0?t.status.next():t.status.end())}),t.util.bindTap(n.getElementById("falseBtn"),function(){t.status.check()&&t.timer.checkCheat()&&(t.status.getEqual()===!1?t.status.next():t.status.end())}),t.util.bindTap(t.ui.restartBtn,function(){t.status.reset()}),t.util.bindTap(t.ui.reviveBtn,function(){t.status.revive()}),"undefined"!=typeof e.localStorage){var i=e.localStorage.getItem("highest");null!==i&&(t.ui.highest.innerText="历史最高分："+i)}else e.localStorage={setItem:function(e,t){},getItem:function(e){return null}};n.addEventListener("touchmove",function(e){e.preventDefault()})}),n.addEventListener("WeixinJSBridgeReady",function(){t.util.show(n.getElementById("share")),WeixinJSBridge.on("menu:share:appmessage",function(){WeixinJSBridge.invoke("sendAppMessage",{appid:t.share.appId,img_url:t.share.img,img_width:t.share.imgSize,img_height:t.share.imgSize,link:t.share.url,desc:t.share.desc,title:t.share.title},function(e){/[\w_]+:cancel/.test(e.err_msg)||t.share.getBonus()})}),WeixinJSBridge.on("menu:share:timeline",function(){WeixinJSBridge.invoke("shareTimeline",{img_url:t.share.img,img_width:t.share.imgSize,img_height:t.share.imgSize,link:t.share.url,desc:t.share.desc,title:t.share.desc},function(e){/[\w_]+:cancel/.test(e.err_msg)||t.share.getBonus()})})})}(window);